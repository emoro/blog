<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Itô calculus for the rest of us &middot; </title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://estebanmoro.org/favicon.ico" />
    <link rel="canonical" href="http://estebanmoro.org/post/2009-02-12-ito-calculus-for-the-rest-of-us/" />

     <meta name="description" content="One of the areas of my research is stochastic differential equations (SDE). I posted about it several times before. One of the things students and collaborators" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="http://estebanmoro.org/img/posts/pdf1.jpg"/>
    
 
    <meta name="twitter:title" content="Itô calculus for the rest of us"/>
    <meta name="twitter:description" content="One of the areas of my research is stochastic differential equations (SDE). I posted about it several times before. One of the things students and collaborators"/>
    <meta name="twitter:url" content="http://estebanmoro.org/post/2009-02-12-ito-calculus-for-the-rest-of-us/" />
    <meta name="twitter:site" content="@estebanmoro"/>

    <meta property="og:site_name" content="" />
    <meta property="og:title" content="Itô calculus for the rest of us &middot; Implicit None" />
    <meta property="og:url" content="http://estebanmoro.org/post/2009-02-12-ito-calculus-for-the-rest-of-us/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="One of the areas of my research is stochastic differential equations (SDE). I posted about it several times before. One of the things students and collaborators" />

    <meta property="article:published_time" content="2009-02-12T08:21:42Z" />
    <meta property="article:tag" content="Fokker-Planck" /><meta property="article:tag" content="Ito" /><meta property="article:tag" content="Stochastic Differential Equations" />

    <meta property="og:image" content="http://estebanmoro.org/img/posts/pdf1.jpg"/>



    <meta name="generator" content="Hugo 0.92.2" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="http://estebanmoro.org/built/screen.css" /> 
    <link rel="stylesheet" type="text/css" href="http://estebanmoro.org/css/casper-two.css" /> 
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/tomorrow-night-bright.min.css" />
     <link rel="stylesheet" href="http://estebanmoro.org/css/overrides.css" /> 

     

</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/categories/publications">Publications</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/categories/projects">Projects</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/categories/science">Science</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/categories/media">Media</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/categories/photos">Photos</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/categories/talks">Talks</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/categories/positions">Positions</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/categories/r">R</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/about/">About/CV</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="http://estebanmoro.org/reading/">Reading</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/estebanmoro" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/emoro" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    <a class="social-link" href="https://www.linkedin.com/in/esteban-moro" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 50 512 512"><path d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683 C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615 c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915 s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z" /></svg></a>

                    
        </div>  
        
        <a class="subscribe-button" href="http://estebanmoro.org/index.xml">Subscribe</a>
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      <article class="post-full post"> 
    <header class="post-full-header">
        <section class="post-full-meta">
            <time class="post-full-meta-date" datetime="2009-02-12">12 February 2009</time>
                <span class="date-divider">/</span> <a href="http://estebanmoro.org/tags/fokker-planck/">#Fokker-Planck</a>&nbsp;<a href="http://estebanmoro.org/tags/ito/">#Ito</a>&nbsp;
        </section>
        <h1 class="post-full-title">Itô calculus for the rest of us</h1>
    </header>
    
    <figure class="post-full-image" style="background-image: url(http://estebanmoro.org/img/posts/pdf1.jpg)">
    </figure>

    <section class="post-full-content">
        <div class="kg-card-markdown">
        <p>One of the areas of my research is stochastic differential equations (SDE). I posted about it <a href="http://estebanmoro.org/2008/12/introduction-to-stochastic-differential-equations/">several</a> <a href="http://estebanmoro.org/2008/11/kiyoshi-ito-93-dies/">times</a> <a href="http://estebanmoro.org/2006/03/writing-bad-letters-of-recommendation-the-story-of-bachelier-and-levy/">before</a>. One of the things students and collaborators keep asking me about SDEs is the weird stochastic <a href="http://en.wikipedia.org/wiki/Ito_stochastic_calculus">Itô Calculus</a>. Itô Calculus is different from what you learn in 101 calculus. In particular, the chain rule is not longer valid. Let me explain it with an example. Suppose you have the following equation</p>
<p><code>$$dX = a dW(t)$$</code></p>
<p>where <code>\(W(t)\)</code> is the Wiener stochastic process: it is a process in which <code>\(W(0) = 0\)</code> and with Gaussian independent increments <code>\(W(t)-W(s) \sim {\cal N}(0,t-s)\)</code>, where <code>\({\cal N}(\mu,\sigma^2)\)</code> are Gaussian random numbers with mean <code>\(\mu\)</code> and variance <code>\(\sigma^2\)</code>. This equation is the simplest SDE and its solution is (obviously),</p>
<p><code>$$X(t) = a W(t)$$</code></p>
<p>But there is a different way to look at SDEs. Since they describe the trayectory of <code>\(X(t)\)</code> subject to <code>\(W(t)\)</code> we can instead ask ourselves what is the probability to find that <code>\(X(t) = x\)</code> in average, i.e. after many different runs of <code>\(W(t)\)</code>. Let&rsquo;s call <code>\(P(x,t)\)</code>that probability which is known to satisfy the <a href="http://en.wikipedia.org/wiki/Fokker%E2%80%93Planck_equation">Fokker-Planck equation</a></p>
<p><code>$$\frac{dP}{dt}=a\frac{d^2P}{dx^2}$$</code></p>
<p>which is the simple diffusion equation. The following figure shows the relationship between <code>\(X(t)\)</code> and <code>\(P(x,t)\)</code>. While <code>\(X(t)\)</code> is a simple trayectory (for a given <code>\(W(t)\)</code> realization), <code>\(P(x,t)\)</code> is the probability to find <code>\(X(t) = x\)</code> over all possible realizations of <code>\(W(t)\)</code>.</p>
<p><img src="http://estebanmoro.org/img/posts/pdf1.jpg" alt="pdf1"></p>
<p>The relationship between <code>\(X(t)\)</code> and <code>\(P(x,t)\)</code> is more general than for the example used here. In general, if we have the SDE</p>
<p><code>$$dX(t) = f(X,t)dt + g(X,t) dW(t)$$</code></p>
<p>in the Itô sense, then <code>\(P(x,t)\)</code> is the solution of</p>
<p><code>$$\frac{\partial P}{\partial t}= - \frac{\partial}{\partial x}\left[f(x,t)P(x,t)\right] + \frac{\partial^2}{\partial x^2}\left[g^2(x,t)P(x,t)\right]$$</code></p>
<p>The term <code>\(f(x,t)\)</code> is usually know as the drift and <code>\(g(x,t)\)</code> is the diffusion term.</p>
<p>Once the relationship between the Fokker-Planck equation and its SDE is given, it is very easy to understand Itô Calculus. For example, given the above SDE <code>\(dX = a dW(t)\)</code>, what is the SDE that will satisfy <code>\(Y(t) = X^2(t)\)</code>?</p>
<p>Instead of using Itô&rsquo;s lemma,  we will use the Fokker Planck equation and traditional calculus. Thus <code>\(\partial/\partial x = 2 \sqrt{y} \partial/\partial y\)</code>. We also have that <code>\(P(x,t) dx = P(y,t) dy\)</code> or <code>\(P(x,t) = 2 \sqrt{y} P(y,t)\)</code>. Putting all these things together we get</p>
<p><code>$$\frac{\partial}{\partial t}2\sqrt{y}P(y,t) = \frac{a^2}{2}\left\{2\frac{\partial}{\partial y}+4y\frac{\partial^2}{\partial y^2}\right\}2\sqrt{y} P(y,t)$$</code></p>
<p>and with a little bit of algebra we get</p>
<p><code>$$\frac{\partial P}{\partial t}=-\frac{\partial}{\partial y}[a^2 P(y,t)] + \frac{a^2}{2}\frac{\partial^2}{\partial y^2}[4yP(y,t)]$$</code></p>
<p>which, according to the general relationship between Fokker-Planck equation and SDE, corresponds to the following SDE</p>
<p><code>$$dY = a^2 dt + 2a \sqrt{Y} dW(t)$$</code></p>
<p>as the Itô&rsquo;s lemma says. Obviously, this way to get the Itô lemma is painful in general, so you’d better use it directly on the SDE instead of the method shown here which goes through the Fokker-Planck equation. However, it is interesting to see that you can recover it from the Fokker-Planck equation.</p>
    
        </div>
    </section>

    <footer class="post-full-footer">
      <section class="author-card">
        <img class="author-profile-image" src="http://estebanmoro.org/img/whoami6.jpg" alt="Author" />
        <section class="author-card-content">
            <h4 class="author-card-name"><a href="http://estebanmoro.org/">Esteban Moro</a></h4>
                <p>Professor at Northeastern University. Working on Complex Systems, Social Networks and Urban Science.</p>
        </section>
      </section>
    </footer>
</article>
    
    
    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "http:\/\/estebanmoro.org\/post\/2009-02-12-ito-calculus-for-the-rest-of-us\/";  
this.page.identifier = "http:\/\/estebanmoro.org\/post\/2009-02-12-ito-calculus-for-the-rest-of-us\/"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://implicitnone.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      
<article class="read-next-card" 
            style="background-image: url(http://estebanmoro.org/img/mob.mp4);" >
    <header class="read-next-card-header">
        <small class="read-next-card-header-sitetitle">&mdash; Implicit None &mdash;</small>
        
        <h3 class="read-next-card-header-title"><a href="http://estebanmoro.org/tags/fokker-planck/">#Fokker-Planck</a></h3>
    </header>
    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
    </div>

    <div class="read-next-card-content">
      
        <ul>
          <li><a href="http://estebanmoro.org/2006/03/writing-bad-letters-of-recommendation-the-story-of-bachelier-and-levy/">Writing bad letters of recommendation: the story of Bachelier and Lévy</a></li>            
        
          <li><a href="http://estebanmoro.org/post/2012-10-29-temporal-network-of-information-diffusion-in-twitter/">Temporal network of information diffusion in Twitter</a></li>            
        
          <li><a href="http://estebanmoro.org/post/2010-11-25-the-dynamical-strength-of-social-ties-in-information-spreading/">Dynamical strength of social ties in information spreading</a></li>            
        
          <li><a href="http://estebanmoro.org/post/2015-04-14-netmob-2015/">Netmob 2015</a></li>            
        </ul>
    </div>
    <footer class="read-next-card-footer">
      
        <a href="http://estebanmoro.org/tags/fokker-planck/">See all related posts →</a>
    </footer>
</article>


      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="http://estebanmoro.org/2009/02/the-use-of-statistics/">

    </a>    
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="http://estebanmoro.org/2009/02/the-use-of-statistics/">
          <header class="post-card-header">
              
              <h2 class="post-card-title">The use of statistics</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>Mark Twain (1924) probably had politicians in mind when he reiterated Disraeli’s famous remark ("There are three kinds of lies: lies, damned lies and statistics"). Scientists, we hope, would never use data in such a selective manner to suit their own ends. But, alas, the analysis of data is often the source of some exasperation even in an academic context. On hearing comments like ‘the result of this experiment was inconclusive, so we had to use statistics’, we are frequently left wondering as to what strange tricks have been played on the data. ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="http://estebanmoro.org/img/whoami6.jpg" alt="Author" />
          <span class="post-card-author"><a href="http://estebanmoro.org/">admin</a></span>
      </footer>
    </div>
</article>
      
      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="http://estebanmoro.org/2009/02/visualizing-citation-networks/">

    </a>    
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="http://estebanmoro.org/2009/02/visualizing-citation-networks/">
          <header class="post-card-header">
              
              <h2 class="post-card-title">Visualizing citation networks</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>The Eigenfactor Project and Moritz Stefaner join efforts to visualize the citation network between different journals belonging to different research fields. It is amazing and a wonderful way to explore patterns in citation networks
 Found via FlowingData </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="http://estebanmoro.org/img/whoami6.jpg" alt="Author" />
          <span class="post-card-author"><a href="http://estebanmoro.org/">admin</a></span>
      </footer>
    </div>
</article>
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="http://estebanmoro.org/">
      
      <span></span>
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">Itô calculus for the rest of us</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>
    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=It%c3%b4%20calculus%20for%20the%20rest%20of%20us&amp;url=http%3a%2f%2festebanmoro.org%2fpost%2f2009-02-12-ito-calculus-for-the-rest-of-us%2f"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2festebanmoro.org%2fpost%2f2009-02-12-ito-calculus-for-the-rest-of-us%2f"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>


<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="http://estebanmoro.org/">Esteban Moro</a> © 2020 <br>
      <span style="font-size: 0.8em; color: #555;">Hugo port of <a href="https://github.com/TryGhost/Casper">Casper 2.1.7</a> by <a href="https://www.telematika.org">EM</a></span>
    </section>
    <nav class="site-footer-nav">
        <a href="http://estebanmoro.org/">Latest Posts</a>
        
        <a href="https://twitter.com/estebanmoro" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/emoro" target="_blank" rel="noopener">Github</a>
        <a href="https://www.linkedin.com/in/esteban-moro" target="_blank" rel="noopener">LinkedIn</a>
        
    </nav>  
  </div>
</footer>

</div>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="http://estebanmoro.org/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script id="altmetric-embed-js" type="text/javascript" src='https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js'></script>


<script>hljs.initHighlightingOnLoad();</script> 






  <!-- Google Analytics -->
  <script>
    var _gaq=[['_setAccount','UA-131034910-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>






    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
